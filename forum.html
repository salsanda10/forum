<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–§–æ—Ä—É–º</title>
<style>
body {
  font-family: system-ui, sans-serif;
  background: #f7f7f7;
  color: #333;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 800px;
  margin: 20px auto;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  padding: 20px;
}
h1 { text-align: center; }

input, button {
  width: 100%;
  padding: 10px;
  margin: 5px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
}
button {
  background: #0077ff;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
}
button:hover { background: #005ccc; }

.toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 5px;
}
.toolbar button {
  width: auto;
  padding: 6px 10px;
  background: #eee;
  color: #333;
  border: 1px solid #ccc;
}
.toolbar button:hover { background: #ccc; }

#topicText[contenteditable] {
  min-height: 120px;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 10px;
  background: #fafafa;
  margin-bottom: 10px;
}

.topic {
  border-left: 4px solid #0077ff;
  margin: 10px 0;
  padding: 10px;
  border-radius: 6px;
  background: #f9f9f9;
}
small { color: #666; }

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.logout {
  background: #ff4f4f;
}
.logout:hover { background: #c93c3c; }

img {
  max-width: 100%;
  border-radius: 6px;
  margin: 5px 0;
}
</style>
</head>
<body>

<div class="container">
  <h1>–ú–∏–Ω–∏-–§–æ—Ä—É–º</h1>

  <div id="auth">
    <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input id="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
    <input id="password" placeholder="–ü–∞—Ä–æ–ª—å" type="password">
    <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    <button onclick="login()">–í–æ–π—Ç–∏</button>
  </div>

  <div id="forum" style="display:none;">
    <div class="header">
      <h2>–ü—Ä–∏–≤–µ—Ç, <span id="userName"></span>!</h2>
      <button class="logout" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>

    <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É</h3>
    <input id="topicTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–º—ã">

    <div class="toolbar">
      <button onclick="format('bold')"><b>B</b></button>
      <button onclick="format('italic')"><i>I</i></button>
      <button onclick="format('insertUnorderedList')">‚Ä¢</button>
      <button onclick="format('insertOrderedList')">1.</button>
      <button onclick="insertLink()">üîó</button>
      <button onclick="format('formatBlock','blockquote')">‚ùù</button>
      <button onclick="format('formatBlock','pre')">[code]</button>
      <button onclick="insertImage()">üì∑</button>
      <input type="file" id="imgInput" accept="image/*" style="display:none">
    </div>

    <div id="topicText" contenteditable="true" placeholder="–¢–µ–∫—Å—Ç —Ç–µ–º—ã..."></div>
    <button onclick="createTopic()">–°–æ–∑–¥–∞—Ç—å —Ç–µ–º—É</button>

    <h3>–¢–µ–º—ã —Ñ–æ—Ä—É–º–∞</h3>
    <div id="topics"></div>
  </div>
</div>

<script>
let users = JSON.parse(localStorage.getItem('users') || '{}');
let currentUser = localStorage.getItem('currentUser');
let topics = JSON.parse(localStorage.getItem('topics') || '[]');
const auth = document.getElementById('auth');
const forum = document.getElementById('forum');
const userName = document.getElementById('userName');
const imgInput = document.getElementById('imgInput');

if (currentUser) showForum();

function saveAll() {
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('topics', JSON.stringify(topics));
}

function register() {
  let u = username.value.trim();
  let p = password.value;
  if (!u || !p) return alert('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!');
  if (users[u]) return alert('–¢–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
  users[u] = p;
  localStorage.setItem('users', JSON.stringify(users));
  currentUser = u;
  localStorage.setItem('currentUser', u);
  showForum();
}

function login() {
  let u = username.value.trim();
  let p = password.value;
  if (!u || !p) return alert('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!');
  if (users[u] !== p) return alert('–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
  currentUser = u;
  localStorage.setItem('currentUser', u);
  showForum();
}

function logout() {
  localStorage.removeItem('currentUser');
  location.reload();
}

function showForum() {
  auth.style.display = 'none';
  forum.style.display = 'block';
  userName.textContent = currentUser;
  renderTopics();
}

function format(cmd, val=null) {
  document.execCommand(cmd, false, val);
}

function insertLink() {
  const url = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É:');
  if (url) document.execCommand('createLink', false, url);
}

function insertImage() {
  imgInput.click();
}

imgInput.addEventListener('change', () => {
  const file = imgInput.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    document.execCommand('insertImage', false, e.target.result);
  };
  reader.readAsDataURL(file);
});

function createTopic() {
  let title = topicTitle.value.trim();
  let text = topicText.innerHTML.trim();
  if (!title || !text) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–µ–∫—Å—Ç —Ç–µ–º—ã!');
  topics.unshift({
    title,
    text,
    author: currentUser,
    date: new Date().toLocaleString()
  });
  topicTitle.value = '';
  topicText.innerHTML = '';
  saveAll();
  renderTopics();
}

function renderTopics() {
  const div = document.getElementById('topics');
  div.innerHTML = '';
  if (topics.length === 0) {
    div.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç —Ç–µ–º.</p>';
    return;
  }
  topics.forEach(t => {
    const el = document.createElement('div');
    el.className = 'topic';
    el.innerHTML = `<b>${t.title}</b><br><small>–æ—Ç ${t.author}, ${t.date}</small><br><div>${t.text}</div>`;
    div.appendChild(el);
  });
}
</script>

</body>
</html>
